<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Inventarios</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            background: linear-gradient(120deg, #e0e7ff 0%, #f6f8fa 100%);
        }
        header {
            background: #3b82f6;
            color: #fff;
            padding: 24px 0 18px 0;
            text-align: center;
            letter-spacing: 2px;
            box-shadow: 0 4px 24px #2563eb22;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 18px;
        }
        nav {
            display: flex;
            justify-content: center;
            background: #fff;
            box-shadow: 0 2px 8px #0001;
            border-bottom: 2px solid #e0e7ff;
        }
        nav button {
            background: none;
            border: none;
            padding: 18px 32px;
            font-size: 1.1em;
            cursor: pointer;
            color: #3b82f6;
            font-weight: 500;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s, border-bottom 0.2s;
            border-radius: 8px 8px 0 0;
            margin: 0 2px;
            box-shadow: 0 1px 4px #2563eb11;
        }
        nav button.active, nav button:hover {
            background: linear-gradient(90deg, #2563eb 60%, #3b82f6 100%);
            color: #fff;
            border-bottom: 3px solid #1e40af;
            box-shadow: 0 4px 16px #2563eb22;
        }
        main {
            width: 100%;
            max-width: 1200px;
            min-width: 0;
            margin: 3vw auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px #2563eb22, 0 1.5px 6px #0001;
            padding: 36px 4vw 30px 4vw;
            transition: box-shadow 0.2s;
            /* La altura se ajusta automáticamente al contenido */
        }
        @media (max-width: 900px) {
            main {
                max-width: 98vw;
                padding-left: 3vw;
                padding-right: 3vw;
            }
        }
        @media (max-width: 700px) {
            main {
                padding: 15px 5px;
                max-width: 100vw;
            }
            nav button { padding: 12px 10px; font-size: 1em; }
        }
        h2 {
            margin-top: 0;
            color: #2563eb;
            font-weight: 600;
        }
        h3 {
            color: #1e40af;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-top: 0;
            margin-bottom: 12px;
        }
        .form-group {
            margin-bottom: 18px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            color: #444;
            font-weight: 500;
        }
        input[type="text"], input[type="number"], .autocomplete-list {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #b6c4e0;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            outline: 2.5px solid #6366f1;
            border-color: #6366f1;
            background: #f0f7ff;
            box-shadow: 0 0 0 3px #6366f133;
        }
        button[type="submit"], #mov-limpiar-filtros {
            background: #3b82f6;
            color: #fff;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
            font-weight: 500;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s;
            box-shadow: 0 2px 8px #2563eb22;
        }
        button[type="submit"]:hover, #mov-limpiar-filtros:hover {
            background: #1e40af;
            color: #fff;
            box-shadow: 0 4px 16px #2563eb33;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
            background: #fafbfc;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px #2563eb11;
        }
        th, td {
            border: 1px solid #e1e4e8;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #e0e7ff;
            color: #2563eb;
            box-shadow: 0 2px 6px #2563eb22;
            letter-spacing: 1px;
        }
        table tbody tr {
            transition: background 0.18s;
        }
        table tbody tr:hover {
            background: #f1f5f9;
        }
        .hidden {
            display: none !important;
        }
        .autocomplete-list {
            position: absolute;
            background: #fff;
            border: 1px solid #b6c4e0;
            border-top: none;
            z-index: 10;
            max-height: 180px;
            overflow-y: auto;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 24px #0003;
            animation: fadeIn 0.18s;
        }
        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
            border-bottom: 1px solid #f3f4f6;
        }
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        .autocomplete-item:hover, .autocomplete-item.active {
            background: #dbeafe;
            color: #1e40af;
        }
        .existencia-info {
            margin-top: 4px;
            font-size: 0.98em;
            color: #2563eb;
            font-weight: 500;
            transition: color 0.2s;
        }
        /* NUEVO: animación de entrada para secciones */
        section {
            animation: fadeInUp 0.4s;
            transition: box-shadow 0.2s;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px);}
            to { opacity: 1; transform: none;}
        }
        @keyframes fadeIn {
            from { opacity: 0;}
            to { opacity: 1;}
        }
        /* NUEVO: efecto de sombra y hover en main */
        main {
            /* ...existing code... */
            box-shadow: 0 8px 32px #2563eb22, 0 1.5px 6px #0001;
            transition: box-shadow 0.2s;
        }
        main:hover {
            box-shadow: 0 12px 40px #2563eb33, 0 2px 8px #0002;
        }
        /* NUEVO: efecto de foco en inputs */
        input[type="text"]:focus, input[type="number"]:focus {
            outline: 2.5px solid #6366f1;
            border-color: #6366f1;
            background: #f0f7ff;
            box-shadow: 0 0 0 3px #6366f133;
        }
        /* NUEVO: efecto de hover en filas de tabla */
        table tbody tr {
            transition: background 0.18s;
        }
        table tbody tr:hover {
            background: #f1f5f9;
        }
        /* NUEVO: efecto de sombra y transición en botones de navegación */
        nav button {
            /* ...existing code... */
            border-radius: 8px 8px 0 0;
            margin: 0 2px;
            box-shadow: 0 1px 4px #2563eb11;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s, border-bottom 0.2s;
        }
        nav button.active, nav button:hover {
            background: linear-gradient(90deg, #2563eb 60%, #3b82f6 100%);
            color: #fff;
            border-bottom: 3px solid #1e40af;
            box-shadow: 0 4px 16px #2563eb22;
        }
        /* NUEVO: efecto de sombra y transición en botones submit */
        button[type="submit"], #mov-limpiar-filtros {
            /* ...existing code... */
            box-shadow: 0 2px 8px #2563eb22;
            transition: background 0.2s, box-shadow 0.2s, color 0.2s;
        }
        button[type="submit"]:hover, #mov-limpiar-filtros:hover {
            background: #1e40af;
            color: #fff;
            box-shadow: 0 4px 16px #2563eb33;
        }
        /* NUEVO: mejorar visual de lista de productos */
        #lista-productos li {
            border-radius: 6px;
            margin-bottom: 4px;
            background: #f3f4f6;
            transition: background 0.18s, color 0.18s;
        }
        #lista-productos li:hover {
            background: #dbeafe;
            color: #1e40af;
        }
        /* NUEVO: mejorar visual de h3 */
        h3 {
            color: #1e40af;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        /* NUEVO: efecto de sombra en header */
        header {
            /* ...existing code... */
            box-shadow: 0 4px 24px #2563eb22;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 18px;
        }
        /* NUEVO: mejorar visual de formularios */
        form {
            background: #f8fafc;
            border-radius: 12px;
            padding: 18px 18px 10px 18px;
            box-shadow: 0 2px 8px #2563eb11;
            margin-bottom: 10px;
            transition: box-shadow 0.2s;
        }
        form:focus-within {
            box-shadow: 0 4px 16px #2563eb22;
        }
        /* NUEVO: mejorar visual de tablas */
        table {
            /* ...existing code... */
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px #2563eb11;
        }
        /* NUEVO: scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
            background: #e0e7ff;
        }
        ::-webkit-scrollbar-thumb {
            background: #b6c4e0;
            border-radius: 4px;
        }
        /* Estilos básicos para el calendario */
        #calendario-movimientos {
            max-width: 100%;
            overflow-x: auto;
        }
        .calendario-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
        .calendario-dia-header {
            font-weight: bold;
            color: #2563eb;
            text-align: center;
            padding: 4px 0;
            background: #e0e7ff;
            border-radius: 6px;
        }
        .calendario-dia {
            min-height: 90px;
            background: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 1px 4px #2563eb11;
            padding: 4px 4px 2px 6px;
            font-size: 0.98em;
            position: relative;
            transition: box-shadow 0.18s;
            border: 1px solid #e5e7eb;
        }
        .calendario-dia.hoy {
            border: 2px solid #3b82f6;
            background: #dbeafe;
        }
        .calendario-dia-num {
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 2px;
        }
        .movimiento-entrada {
            background: #bbf7d0;
            color: #166534;
            border-radius: 4px;
            padding: 2px 4px;
            margin-bottom: 2px;
            font-size: 0.97em;
            display: block;
        }
        .movimiento-salida {
            background: #fee2e2;
            color: #991b1b;
            border-radius: 4px;
            padding: 2px 4px;
            margin-bottom: 2px;
            font-size: 0.97em;
            display: block;
        }
        .calendario-dia.vacio {
            background: transparent;
            border: none;
            box-shadow: none;
        }
        .calendario-nav button {
            background: #3b82f6;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 4px 12px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.18s;
        }
        .calendario-nav button:hover {
            background: #1e40af;
        }
        /* NUEVO: estilos para el selector de mes/año */
        #selector-mes-anio {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        #selector-mes-anio select {
            padding: 8px 12px;
            border: 1px solid #b6c4e0;
            border-radius: 6px;
            font-size: 1em;
            background: #fff;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #selector-mes-anio select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px #6366f133;
        }
        .nueva-cabecera-mes {
            background: #2563eb;
            color: #fff;
            font-size: 1.18em;
            font-weight: bold;
            border-radius: 10px;
            padding: 10px 0 10px 0;
            margin: 18px 0 10px 0;
            text-align: center;
            letter-spacing: 1px;
        }
        /* Tarjeta moderna para inventarioo */
        .tarjeta-inventario {
            background: linear-gradient(120deg, #2563eb 60%, #3b82f6 100%);
            border-radius: 18px;
            box-shadow: 0 6px 24px #2563eb33, 0 1.5px 6px #0001;
            color: #fff;
            min-width: 220px;
            max-width: 260px;
            min-height: 120px;
            padding: 24px 22px 20px 22px;
            margin-bottom: 12px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            transition: box-shadow 0.22s, transform 0.18s, background 0.22s;
            overflow: hidden;
        }
        .tarjeta-inventario:hover {
            box-shadow: 0 14px 40px #2563eb44, 0 2px 8px #0002;
            transform: translateY(-6px) scale(1.045);
            background: linear-gradient(120deg, #1e40af 60%, #2563eb 100%);
        }
        .tarjeta-inventario .existencia {
            position: absolute;
            top: 18px;
            right: 22px;
            background: #fff;
            color: #2563eb;
            font-weight: bold;
            font-size: 1.35em;
            border-radius: 10px;
            padding: 6px 18px;
            box-shadow: 0 2px 12px #2563eb22;
            letter-spacing: 1px;
            border: 2px solid #3b82f6;
            transition: color 0.18s, border 0.18s;
        }
        .tarjeta-inventario:hover .existencia {
            color: #1e40af;
            border: 2px solid #1e40af;
        }
        .tarjeta-inventario .nombre {
            margin-top: 54px;
            font-size: 1.22em;
            font-weight: 700;
            text-align: left;
            letter-spacing: 1.2px;
            word-break: break-word;
            text-shadow: 0 2px 8px #1e40af33;
            line-height: 1.25;
        }
        /* NUEVO: icono decorativo */
        .tarjeta-inventario::before {
            content: "🧵";
            position: absolute;
            top: 18px;
            left: 18px;
            font-size: 2em;
            opacity: 0.18;
            pointer-events: none;
            filter: blur(0.5px);
        }
        @media (max-width: 700px) {
            #tarjetas-inventario { flex-direction: column; gap: 14px; }
            .tarjeta-inventario { min-width: 0; max-width: 100%; }
        }
        @media (max-width: 700px) {
            main { padding: 15px 5px; }
            nav button { padding: 12px 10px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Sistema de Inventarios</h1>
    </header>
    <nav>
        <button id="btn-productos" class="active">Nuevos Productos</button>
        <button id="btn-entradas">Entradas</button>
        <button id="btn-salidas">Salidas</button>
        <button id="btn-inventario">Inventario</button>
        <button id="btn-movimientos">Movimientos</button>
    </nav>
    <main>
        <!-- Notificación moderna -->
        <div id="toast-notificacion" style="display:none;position:fixed;top:32px;right:32px;z-index:9999;min-width:260px;max-width:340px;padding:18px 26px;background:linear-gradient(90deg,#f87171 60%,#fbbf24 100%);color:#fff;font-size:1.08em;font-weight:500;border-radius:12px;box-shadow:0 8px 32px #0004;transition:opacity 0.3s,transform 0.3s;opacity:0;pointer-events:none;"></div>
        <!-- NUEVOS PRODUCTOS -->
        <section id="ventana-productos">
            <h2>Agregar Producto Nuevo</h2>
            <div style="display:flex;gap:32px;align-items:flex-start;">
                <!-- Contenedor izquierdo: buscador y lista de productos -->
                <div style="flex:1;max-width:260px;">
                    <div class="form-group" style="position:relative;display:flex;gap:6px;">
                        <label style="font-size:0.98em;color:#444;flex:1;">Buscar producto:</label>
                    </div>
                    <div class="form-group" style="position:relative;display:flex;gap:6px;">
                        <input type="text" id="buscar-producto-lista" autocomplete="off" placeholder="Buscar producto..." style="flex:1;">
                        <button type="button" id="btn-limpiar-buscar-producto-lista" title="Limpiar" style="padding:0 10px;background:#e0e7ff;color:#2563eb;border:none;border-radius:6px;cursor:pointer;font-size:1.1em;">✕</button>
                        <div id="buscar-autocomplete-lista" class="autocomplete-list hidden"></div>
                    </div>
                    <div style="margin-top:10px;">
                        <h3 style="margin:0 0 8px 0;font-size:1.08em;color:#2563eb;">Productos agregados</h3>
                        <ul id="lista-productos" style="list-style:none;padding:0;margin:0;max-height:320px;overflow-y:auto;">
                            <!-- Productos aquí -->
                        </ul>
                    </div>
                </div>
                <!-- Contenedor derecho: formulario -->
                <div style="flex:2;">
                    <form id="form-nuevo">
                        <div class="form-group">
                            <label>Nombre:</label>
                            <input type="text" id="nuevo-nombre" required autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label>Cantidad inicial:</label>
                            <input type="number" id="nuevo-cantidad" min="0" required>
                        </div>
                        <button type="submit">Agregar Producto</button>
                    </form>
                </div>
            </div>
        </section>
        <!-- ENTRADAS -->
        <section id="ventana-entradas" class="hidden">
            <h2>Registrar Entrada</h2>
            <form id="form-entrada" autocomplete="off">
                <div class="form-group" style="position:relative;">
                    <label>Producto:</label>
                    <input type="text" id="entrada-producto" autocomplete="off" required>
                    <div id="entrada-autocomplete" class="autocomplete-list hidden"></div>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" id="entrada-cantidad" min="1" required>
                </div>
                <button type="submit">Registrar Entrada</button>
            </form>
            <h3 style="margin-top:28px;color:#2563eb;">Entradas registradas</h3>
            <table id="tabla-entradas">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Fecha y Hora</th>
                        <th>Equipo</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Entradas aquí -->
                </tbody>
            </table>
        </section>
        <!-- SALIDAS -->
        <section id="ventana-salidas" class="hidden">
            <h2>Registrar Salida</h2>
            <form id="form-salida" autocomplete="off" style="position:relative;">
                <div class="form-group" style="position:relative;">
                    <label>Producto:</label>
                    <input type="text" id="salida-producto" autocomplete="off" required>
                    <div id="salida-autocomplete" class="autocomplete-list hidden"></div>
                    <div id="salida-existencia" class="existencia-info" style="position:absolute;top:0;right:0;text-align:left;"></div>
                </div>
                <div class="form-group">
                    <label>Cantidad:</label>
                    <input type="number" id="salida-cantidad" min="1" required>
                </div>
                <button type="submit">Registrar Salida</button>
            </form>
            <h3 style="margin-top:28px;color:#2563eb;">Salidas registradas</h3>
            <table id="tabla-salidas">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Fecha y Hora</th>
                        <th>Equipo</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Salidas aquí -->
                </tbody>
            </table>
        </section>
        <!-- INVENTARIO -->
        <section id="ventana-inventario" class="hidden">
            <h2>Inventario Actual</h2>
            <!-- Buscador de tarjetas de inventario -->
            <div style="display:flex;gap:10px;align-items:center;margin-bottom:18px;">
                <input type="text" id="buscar-inventario" placeholder="Buscar producto..." style="flex:1;padding:10px 12px;border:1px solid #b6c4e0;border-radius:6px;font-size:1em;">
                <button type="button" id="btn-limpiar-buscar-inventario" title="Limpiar" style="padding:8px 18px;background:#e0e7ff;color:#2563eb;border:none;border-radius:6px;cursor:pointer;font-size:1em;font-weight:500;">Limpiar</button>
            </div>
            <!-- Contenedor de tarjetas de inventario -->
            <div id="tarjetas-inventario" style="display:flex;flex-wrap:wrap;gap:22px;"></div>
        </section>
        <!-- MOVIMIENTOS -->
        <section id="ventana-movimientos" class="hidden">
            <h2>Movimientos de Inventario</h2>
            <div style="display:flex;gap:12px;align-items:end;flex-wrap:wrap;margin-bottom:18px;">
                <div style="flex:1;position:relative;">
                    <label style="font-size:0.98em;color:#444;">Buscar producto:</label>
                    <div style="display:flex;gap:6px;align-items:center;margin-top:6px;">
                        <input type="text" id="mov-buscar-producto" autocomplete="off" placeholder="Escriba para buscar..." style="flex:1;">
                        <button type="button" id="mov-limpiar-filtros" title="Limpiar" style="min-width:90px;padding:8px 0;background:#e0e7ff;color:#2563eb;border:none;border-radius:6px;cursor:pointer;font-size:1em;font-weight:500;">Limpiar</button>
                    </div>
                    <div id="mov-autocomplete" class="autocomplete-list hidden"></div>
                </div>
            </div>
            <!-- Calendario dinámico de movimientos -->
            <div id="calendario-movimientos" style="margin-top:18px;"></div>
            <style>
                /* Estilos básicos para el calendario */
                #calendario-movimientos {
                    max-width: 100%;
                    overflow-x: auto;
                }
                .calendario-nav {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .calendario-grid {
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 6px;
                }
                .calendario-dia-header {
                    font-weight: bold;
                    color: #2563eb;
                    text-align: center;
                    padding: 4px 0;
                    background: #e0e7ff;
                    border-radius: 6px;
                }
                .calendario-dia {
                    min-height: 90px;
                    background: #f8fafc;
                    border-radius: 8px;
                    box-shadow: 0 1px 4px #2563eb11;
                    padding: 4px 4px 2px 6px;
                    font-size: 0.98em;
                    position: relative;
                    transition: box-shadow 0.18s;
                    border: 1px solid #e5e7eb;
                }
                .calendario-dia.hoy {
                    border: 2px solid #3b82f6;
                    background: #dbeafe;
                }
                .calendario-dia-num {
                    font-weight: bold;
                    color: #1e40af;
                    margin-bottom: 2px;
                }
                .movimiento-entrada {
                    background: #bbf7d0;
                    color: #166534;
                    border-radius: 4px;
                    padding: 2px 4px;
                    margin-bottom: 2px;
                    font-size: 0.97em;
                    display: block;
                }
                .movimiento-salida {
                    background: #fee2e2;
                    color: #991b1b;
                    border-radius: 4px;
                    padding: 2px 4px;
                    margin-bottom: 2px;
                    font-size: 0.97em;
                    display: block;
                }
                .calendario-dia.vacio {
                    background: transparent;
                    border: none;
                    box-shadow: none;
                }
                .calendario-nav button {
                    background: #3b82f6;
                    color: #fff;
                    border: none;
                    border-radius: 5px;
                    padding: 4px 12px;
                    font-size: 1em;
                    cursor: pointer;
                    transition: background 0.18s;
                }
                .calendario-nav button:hover {
                    background: #1e40af;
                }
                /* NUEVO: estilos para el selector de mes/año */
                #selector-mes-anio {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                    margin-bottom: 12px;
                }
                #selector-mes-anio select {
                    padding: 8px 12px;
                    border: 1px solid #b6c4e0;
                    border-radius: 6px;
                    font-size: 1em;
                    background: #fff;
                    cursor: pointer;
                    transition: border-color 0.2s, box-shadow 0.2s;
                }
                #selector-mes-anio select:focus {
                    outline: none;
                    border-color: #6366f1;
                    box-shadow: 0 0 0 3px #6366f133;
                }
                .nueva-cabecera-mes {
                    background: #2563eb;
                    color: #fff;
                    font-size: 1.18em;
                    font-weight: bold;
                    border-radius: 10px;
                    padding: 10px 0 10px 0;
                    margin: 18px 0 10px 0;
                    text-align: center;
                    letter-spacing: 1px;
                }
                /* Tarjeta moderna para inventario */
                .tarjeta-inventario {
                    background: linear-gradient(120deg, #2563eb 60%, #3b82f6 100%);
                    border-radius: 18px;
                    box-shadow: 0 6px 24px #2563eb33, 0 1.5px 6px #0001;
                    color: #fff;
                    min-width: 220px;
                    max-width: 260px;
                    min-height: 120px;
                    padding: 24px 22px 20px 22px;
                    margin-bottom: 12px;
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    justify-content: flex-end;
                    transition: box-shadow 0.22s, transform 0.18s, background 0.22s;
                    overflow: hidden;
                }
                .tarjeta-inventario:hover {
                    box-shadow: 0 14px 40px #2563eb44, 0 2px 8px #0002;
                    transform: translateY(-6px) scale(1.045);
                    background: linear-gradient(120deg, #1e40af 60%, #2563eb 100%);
                }
                .tarjeta-inventario .existencia {
                    position: absolute;
                    top: 18px;
                    right: 22px;
                    background: #fff;
                    color: #2563eb;
                    font-weight: bold;
                    font-size: 1.35em;
                    border-radius: 10px;
                    padding: 6px 18px;
                    box-shadow: 0 2px 12px #2563eb22;
                    letter-spacing: 1px;
                    border: 2px solid #3b82f6;
                    transition: color 0.18s, border 0.18s;
                }
                .tarjeta-inventario:hover .existencia {
                    color: #1e40af;
                    border: 2px solid #1e40af;
                }
                .tarjeta-inventario .nombre {
                    margin-top: 54px;
                    font-size: 1.22em;
                    font-weight: 700;
                    text-align: left;
                    letter-spacing: 1.2px;
                    word-break: break-word;
                    text-shadow: 0 2px 8px #1e40af33;
                    line-height: 1.25;
                }
                /* NUEVO: icono decorativo */
                .tarjeta-inventario::before {
                    content: "🧵";
                    position: absolute;
                    top: 18px;
                    left: 18px;
                    font-size: 2em;
                    opacity: 0.18;
                    pointer-events: none;
                    filter: blur(0.5px);
                }
                @media (max-width: 700px) {
                    #tarjetas-inventario { flex-direction: column; gap: 14px; }
                    .tarjeta-inventario { min-width: 0; max-width: 100%; }
                }
                @media (max-width: 700px) {
                    main { padding: 15px 5px; }
                    nav button { padding: 12px 10px; font-size: 1em; }
                }
            </style>
        </section>
    </main>
    <script>
        // --- CONFIGURACIÓN API ---
     const API_URL = '/api';


        let inventario = [];
        let movimientos = [];
        let entradas = [];
        let salidas = [];

        // --- FUNCIONES DE API ---
        async function cargarInventario() {
            try {
                const res = await fetch(`${API_URL}/inventario`);
                if (!res.ok) throw new Error('No se pudo conectar con el backend');
                inventario = await res.json();
            } catch (err) {
                alert('No se pudo conectar con el backend. ¿Está corriendo el servidor?\n\n' + err.message);
                inventario = [];
            }
        }
        async function cargarMovimientos() {
            try {
                const res = await fetch(`${API_URL}/movimientos`);
                if (!res.ok) throw new Error('No se pudo conectar con el backend');
                movimientos = await res.json();
            } catch (err) {
                alert('No se pudo conectar con el backend. ¿Está corriendo el servidor?\n\n' + err.message);
                movimientos = [];
            }
        }
        async function cargarEntradas() {
            try {
                const res = await fetch(`${API_URL}/entradas`);
                if (!res.ok) throw new Error('No se pudo cargar la tabla de entradas');
                entradas = await res.json();
            } catch (err) {
                entradas = [];
            }
        }
        async function cargarSalidas() {
            try {
                const res = await fetch(`${API_URL}/salidas`);
                if (!res.ok) throw new Error('No se pudo cargar la tabla de salidas');
                salidas = await res.json();
            } catch (err) {
                salidas = [];
            }
        }
        async function agregarProducto(nombre, cantidad) {
            try {
                const res = await fetch(`${API_URL}/inventario`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nombre, cantidad })
                });
                if (!res.ok) {
                    const data = await res.json();
                    throw new Error(data.error || 'Error al agregar producto');
                }
            } catch (err) {
                alert('No se pudo conectar con el backend. ¿Está corriendo el servidor?\n\n' + err.message);
                throw err;
            }
        }
        async function registrarEntrada(nombre, cantidad, equipo) {
            try {
                const res = await fetch(`${API_URL}/entrada`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nombre, cantidad, equipo })
                });
                if (!res.ok) {
                    const data = await res.json();
                    throw new Error(data.error || 'Error al registrar entrada');
                }
            } catch (err) {
                alert('No se pudo conectar con el backend. ¿Está corriendo el servidor?\n\n' + err.message);
                throw err;
            }
        }
        async function registrarSalida(nombre, cantidad, equipo) {
            try {
                const res = await fetch(`${API_URL}/salida`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nombre, cantidad, equipo })
                });
                if (!res.ok) {
                    const data = await res.json();
                    throw new Error(data.error || 'Error al registrar salida');
                }
            } catch (err) {
                alert('No se pudo conectar con el backend. ¿Está corriendo el servidor?\n\n' + err.message);
                throw err;
            }
        }

        // --- INICIALIZACIÓN ---
        async function inicializarDatos() {
            await cargarInventario();
            await cargarMovimientos();
            await cargarEntradas();
            await cargarSalidas();
            actualizarTabla();
            actualizarMovimientos();
            actualizarListaProductos();
            actualizarTablaEntradas();
            actualizarTablaSalidas();
        }

        // Cambiar de ventana
        const secciones = {
            'btn-productos': 'ventana-productos',
            'btn-entradas': 'ventana-entradas',
            'btn-salidas': 'ventana-salidas',
            'btn-inventario': 'ventana-inventario',
            'btn-movimientos': 'ventana-movimientos'
        };
        Object.keys(secciones).forEach(btnId => {
            document.getElementById(btnId).addEventListener('click', async function() {
                // Botón activo
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                // Mostrar sección
                Object.values(secciones).forEach(secId => {
                    document.getElementById(secId).classList.add('hidden');
                });
                document.getElementById(secciones[btnId]).classList.remove('hidden');
                // Actualizar tablas si es necesario
                if (btnId === 'btn-inventario') {
                    await cargarInventario();
                    actualizarTabla();
                }
                if (btnId === 'btn-movimientos') {
                    await cargarMovimientos();
                    actualizarMovimientos();
                }
                if (btnId === 'btn-entradas') {
                    await cargarEntradas();
                    actualizarTablaEntradas();
                }
                if (btnId === 'btn-salidas') {
                    await cargarSalidas();
                    actualizarTablaSalidas();
                }
            });
        });

        // Autocompletado para entradas y salidas
        function setupAutocomplete(inputId, listId, onSelect) {
            const input = document.getElementById(inputId);
            const list = document.getElementById(listId);

            input.addEventListener('input', function() {
                const val = input.value.trim().toLowerCase();
                list.innerHTML = '';
                if (!val) {
                    list.classList.add('hidden');
                    return;
                }
                const matches = inventario.filter(p => p.nombre.toLowerCase().includes(val));
                if (matches.length === 0) {
                    list.classList.add('hidden');
                    return;
                }
                matches.forEach(prod => {
                    const div = document.createElement('div');
                    div.className = 'autocomplete-item';
                    div.textContent = prod.nombre;
                    div.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        input.value = prod.nombre;
                        list.classList.add('hidden');
                        if (onSelect) onSelect(prod);
                    });
                    list.appendChild(div);
                });
                list.classList.remove('hidden');
            });

            input.addEventListener('blur', function() {
                setTimeout(() => list.classList.add('hidden'), 120);
            });

            input.addEventListener('focus', function() {
                input.dispatchEvent(new Event('input'));
            });
        }

        // Mostrar existencia en salida (ahora también guarda el producto seleccionado)
        let productoSalidaSeleccionado = null;
        function mostrarExistenciaSalida(prod) {
            const div = document.getElementById('salida-existencia');
            if (prod) {
                div.textContent = `Existencia: ${prod.cantidad}`;
                productoSalidaSeleccionado = prod;
            } else {
                div.textContent = '';
                productoSalidaSeleccionado = null;
            }
        }

        setupAutocomplete('entrada-producto', 'entrada-autocomplete');
        setupAutocomplete('salida-producto', 'salida-autocomplete', mostrarExistenciaSalida);

        // --- FILTRO Y AUTOCOMPLETADO EN MOVIMIENTOS ---
        let filtroMovProducto = '';

        function setupMovimientosAutocomplete() {
            const input = document.getElementById('mov-buscar-producto');
            const list = document.getElementById('mov-autocomplete');
            input.addEventListener('input', function() {
                const val = input.value.trim().toLowerCase();
                filtroMovProducto = val;
                actualizarMovimientos();
                list.innerHTML = '';
                if (!val) {
                    list.classList.add('hidden');
                    return;
                }
                // Productos únicos de movimientos
                const productos = [...new Set(movimientos.map(m => m.producto))];
                const matches = productos.filter(nombre => nombre.toLowerCase().includes(val));
                if (matches.length === 0) {
                    list.classList.add('hidden');
                    return;
                }
                matches.forEach(nombre => {
                    const div = document.createElement('div');
                    div.className = 'autocomplete-item';
                    div.textContent = nombre;
                    div.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        input.value = nombre;
                        filtroMovProducto = nombre.toLowerCase();
                        list.classList.add('hidden');
                        actualizarMovimientos();
                    });
                    list.appendChild(div);
                });
                list.classList.remove('hidden');
            });
            input.addEventListener('blur', function() {
                setTimeout(() => list.classList.add('hidden'), 120);
            });
            input.addEventListener('focus', function() {
                input.dispatchEvent(new Event('input'));
            });
        }

        // --- CALENDARIO DE MOVIMIENTOS CON SELECCIÓN DE MES/AÑO ---
        let calendarioMes = (new Date()).getMonth();
        let calendarioAnio = (new Date()).getFullYear();

        // NUEVO: Selector de mes y año
        function renderizarSelectorMesAnio() {
            const cont = document.getElementById('calendario-movimientos');
            let selector = document.getElementById('selector-mes-anio');
            if (!selector) {
                selector = document.createElement('div');
                selector.id = 'selector-mes-anio';
                selector.style.display = 'flex';
                selector.style.justifyContent = 'center';
                selector.style.alignItems = 'center';
                selector.style.gap = '10px';
                selector.style.marginBottom = '12px';
                cont.prepend(selector);
            } else {
                selector.innerHTML = '';
            }
            // Mes
            const mesesNombres = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            const mesSel = document.createElement('select');
            mesesNombres.forEach((m, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = m;
                if (i === calendarioMes) opt.selected = true;
                mesSel.appendChild(opt);
            });
            // Año (rango +/- 5 años)
            const anioSel = document.createElement('select');
            const anioActual = (new Date()).getFullYear();
            for (let y = anioActual - 5; y <= anioActual + 5; y++) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.textContent = y;
                if (y === calendarioAnio) opt.selected = true;
                anioSel.appendChild(opt);
            }
            mesSel.addEventListener('change', function() {
                calendarioMes = parseInt(this.value, 10);
                actualizarMovimientos();
            });
            anioSel.addEventListener('change', function() {
                calendarioAnio = parseInt(this.value, 10);
                actualizarMovimientos();
            });
            selector.appendChild(mesSel);
            selector.appendChild(anioSel);
        }

        function renderizarCalendarioMovimientos() {
            const cont = document.getElementById('calendario-movimientos');
            cont.innerHTML = '';
            renderizarSelectorMesAnio();

            const mesesNombres = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            const hoy = new Date();

            // Solo mostrar el mes/año seleccionado
            const mes = calendarioMes;
            const anio = calendarioAnio;

            // Cabecera de mes
            const nav = document.createElement('div');
            nav.className = 'calendario-nav';
            const titulo = document.createElement('span');
            titulo.textContent = `${mesesNombres[mes]} ${anio}`;
            nav.appendChild(document.createElement('div'));
            nav.appendChild(titulo);
            nav.appendChild(document.createElement('div'));
            cont.appendChild(nav);

            // Cabecera días de la semana
            const diasSemana = ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'];
            const grid = document.createElement('div');
            grid.className = 'calendario-grid';
            diasSemana.forEach(d => {
                const th = document.createElement('div');
                th.className = 'calendario-dia-header';
                th.textContent = d;
                grid.appendChild(th);
            });

            // Primer día del mes
            const primerDia = new Date(anio, mes, 1);
            const ultimoDia = new Date(anio, mes + 1, 0);
            let diaSemana = primerDia.getDay();
            // Días vacíos antes del 1
            for (let i = 0; i < diaSemana; i++) {
                const vacio = document.createElement('div');
                vacio.className = 'calendario-dia vacio';
                grid.appendChild(vacio);
            }
            // Días del mes
            for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                const fecha = new Date(anio, mes, dia);
                const fechaStr = fecha.toISOString().slice(0,10); // yyyy-mm-dd
                const div = document.createElement('div');
                div.className = 'calendario-dia';
                if (
                    fecha.getDate() === hoy.getDate() &&
                    fecha.getMonth() === hoy.getMonth() &&
                    fecha.getFullYear() === hoy.getFullYear()
                ) {
                    div.classList.add('hoy');
                }
                // Número de día
                const num = document.createElement('div');
                num.className = 'calendario-dia-num';
                num.textContent = dia;
                div.appendChild(num);

                // Movimientos de ese día
                let movs = movimientos.filter(mov => {
                    let movFecha = new Date(mov.fecha);
                    if (isNaN(movFecha)) {
                        const partes = mov.fecha.split(/[\/\-\s:]/);
                        if (partes.length >= 3) {
                            let anioP = parseInt(partes[0], 10);
                            let mesP = parseInt(partes[1], 10) - 1;
                            let diaP = parseInt(partes[2], 10);
                            movFecha = new Date(anioP, mesP, diaP);
                        }
                    }
                    // yyyy-mm-dd
                    const movStr = movFecha.getFullYear().toString().padStart(4, '0') + '-' +
                        (movFecha.getMonth() + 1).toString().padStart(2, '0') + '-' +
                        movFecha.getDate().toString().padStart(2, '0');
                    return movStr === fechaStr;
                }).filter(mov => {
                    // Solo filtrar por producto
                    let ok = true;
                    if (filtroMovProducto) ok = ok && mov.producto.toLowerCase().includes(filtroMovProducto);
                    return ok;
                });

                if (movs.length === 0) {
                    // Nada
                } else {
                    movs.forEach(mov => {
                        const span = document.createElement('span');
                        if (mov.tipo && mov.tipo.toLowerCase().includes('entrada')) {
                            span.className = 'movimiento-entrada';
                            span.textContent = `Entrada: ${mov.producto} (${mov.cantidad})`;
                        } else if (mov.tipo && mov.tipo.toLowerCase().includes('salida')) {
                            span.className = 'movimiento-salida';
                            span.textContent = `Salida: ${mov.producto} (${mov.cantidad})`;
                        } else {
                            span.className = 'movimiento-entrada';
                            span.textContent = `${mov.tipo}: ${mov.producto} (${mov.cantidad})`;
                        }
                        div.appendChild(span);
                    });
                }
                grid.appendChild(div);
            }
            // Días vacíos al final
            let totalCeldas = diaSemana + ultimoDia.getDate();
            for (let i = totalCeldas; i % 7 !== 0; i++) {
                const vacio = document.createElement('div');
                vacio.className = 'calendario-dia vacio';
                grid.appendChild(vacio);
            }
            cont.appendChild(grid);
        }

        // Sobrescribe actualizarMovimientos para usar el calendario con selector
        function actualizarMovimientos() {
            // Si hay filtro de producto, mostrar todos los movimientos de ese producto en el calendario,
            // aunque no sean del mes/año seleccionado.
            renderizarCalendarioMovimientosPersonalizado();
        }

        // NUEVO: renderizarCalendarioMovimientosPersonalizado para filtrar por producto sin importar mes/año
        function renderizarCalendarioMovimientosPersonalizado() {
            const cont = document.getElementById('calendario-movimientos');
            cont.innerHTML = '';
            renderizarSelectorMesAnio();

            const mesesNombres = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            const hoy = new Date();

            // Si hay filtro de producto, obtener todos los movimientos de ese producto
            let movimientosFiltrados = movimientos;
            if (filtroMovProducto) {
                movimientosFiltrados = movimientos.filter(mov => mov.producto && mov.producto.toLowerCase().includes(filtroMovProducto));
            }

            // Agrupar movimientos por mes/año si hay filtro, si no, solo el mes/año seleccionado
            let grupos = [];
            if (filtroMovProducto && movimientosFiltrados.length > 0) {
                // Agrupar por mes/año
                const map = {};
                movimientosFiltrados.forEach(mov => {
                    let fecha = new Date(mov.fecha);
                    if (isNaN(fecha)) {
                        const partes = mov.fecha.split(/[\/\-\s:]/);
                        if (partes.length >= 3) {
                            let anioP = parseInt(partes[0], 10);
                            let mesP = parseInt(partes[1], 10) - 1;
                            fecha = new Date(anioP, mesP, 1);
                        }
                    }
                    const key = fecha.getFullYear() + '-' + (fecha.getMonth()+1).toString().padStart(2,'0');
                    if (!map[key]) map[key] = [];
                    map[key].push(mov);
                });
                // Ordenar por fecha ascendente
                const claves = Object.keys(map).sort();
                grupos = claves.map(key => {
                    const [anio, mes] = key.split('-');
                    return {
                        anio: parseInt(anio,10),
                        mes: parseInt(mes,10)-1,
                        movimientos: map[key]
                    };
                });
            } else {
                // Solo el mes/año seleccionado
                grupos = [{
                    anio: calendarioAnio,
                    mes: calendarioMes,
                    movimientos: movimientos.filter(mov => {
                        let fecha = new Date(mov.fecha);
                        if (isNaN(fecha)) {
                            const partes = mov.fecha.split(/[\/\-\s:]/);
                            if (partes.length >= 3) {
                                let anioP = parseInt(partes[0], 10);
                                let mesP = parseInt(partes[1], 10) - 1;
                                fecha = new Date(anioP, mesP, 1);
                            }
                        }
                        return fecha.getFullYear() === calendarioAnio && fecha.getMonth() === calendarioMes;
                    })
                }];
            }

            grupos.forEach(grupo => {
                // NUEVO: Cabecera mes/año en rectángulo azul
                const cabecera = document.createElement('div');
                cabecera.className = 'nueva-cabecera-mes';
                cabecera.textContent = `${mesesNombres[grupo.mes]} ${grupo.anio}`;
                cont.appendChild(cabecera);

                // Cabecera días de la semana
                const diasSemana = ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'];
                const grid = document.createElement('div');
                grid.className = 'calendario-grid';
                diasSemana.forEach(d => {
                    const th = document.createElement('div');
                    th.className = 'calendario-dia-header';
                    th.textContent = d;
                    grid.appendChild(th);
                });

                // Primer día del mes
                const primerDia = new Date(grupo.anio, grupo.mes, 1);
                const ultimoDia = new Date(grupo.anio, grupo.mes + 1, 0);
                let diaSemana = primerDia.getDay();
                // Días vacíos antes del 1
                for (let i = 0; i < diaSemana; i++) {
                    const vacio = document.createElement('div');
                    vacio.className = 'calendario-dia vacio';
                    grid.appendChild(vacio);
                }
                // Días del mes
                for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                    const fecha = new Date(grupo.anio, grupo.mes, dia);
                    const fechaStr = fecha.toISOString().slice(0,10); // yyyy-mm-dd
                    const div = document.createElement('div');
                    div.className = 'calendario-dia';
                    if (
                        fecha.getDate() === hoy.getDate() &&
                        fecha.getMonth() === hoy.getMonth() &&
                        fecha.getFullYear() === hoy.getFullYear()
                    ) {
                        div.classList.add('hoy');
                    }
                    // Número de día
                    const num = document.createElement('div');
                    num.className = 'calendario-dia-num';
                    num.textContent = dia;
                    div.appendChild(num);

                    // Movimientos de ese día (filtrados por producto si aplica)
                    let movs = grupo.movimientos.filter(mov => {
                        let movFecha = new Date(mov.fecha);
                        if (isNaN(movFecha)) {
                            const partes = mov.fecha.split(/[\/\-\s:]/);
                            if (partes.length >= 3) {
                                let anioP = parseInt(partes[0], 10);
                                let mesP = parseInt(partes[1], 10) - 1;
                                let diaP = parseInt(partes[2], 10);
                                movFecha = new Date(anioP, mesP, diaP);
                            }
                        }
                        // yyyy-mm-dd
                        const movStr = movFecha.getFullYear().toString().padStart(4, '0') + '-' +
                            (movFecha.getMonth() + 1).toString().padStart(2, '0') + '-' +
                            movFecha.getDate().toString().padStart(2, '0');
                        return movStr === fechaStr;
                    });

                    if (movs.length === 0) {
                        // Nada
                    } else {
                        movs.forEach(mov => {
                            const span = document.createElement('span');
                            if (mov.tipo && mov.tipo.toLowerCase().includes('entrada')) {
                                span.className = 'movimiento-entrada';
                                span.textContent = `Entrada: ${mov.producto} (${mov.cantidad})`;
                            } else if (mov.tipo && mov.tipo.toLowerCase().includes('salida')) {
                                span.className = 'movimiento-salida';
                                span.textContent = `Salida: ${mov.producto} (${mov.cantidad})`;
                            } else {
                                span.className = 'movimiento-entrada';
                                span.textContent = `${mov.tipo}: ${mov.producto} (${mov.cantidad})`;
                            }
                            div.appendChild(span);
                        });
                    }
                    grid.appendChild(div);
                }
                // Días vacíos al final
                let totalCeldas = diaSemana + ultimoDia.getDate();
                for (let i = totalCeldas; i % 7 !== 0; i++) {
                    const vacio = document.createElement('div');
                    vacio.className = 'calendario-dia vacio';
                    grid.appendChild(vacio);
                }
                cont.appendChild(grid);
            });
        }

        // --- FORMULARIO NUEVO PRODUCTO ---
        document.getElementById('form-nuevo').addEventListener('submit', async function(e) {
            e.preventDefault();
            const nombre = document.getElementById('nuevo-nombre').value.trim();
            const cantidad = parseInt(document.getElementById('nuevo-cantidad').value, 10);
            if (!nombre || isNaN(cantidad) || cantidad < 0) return;
            try {
                await agregarProducto(nombre, cantidad);
                await cargarInventario();
                actualizarTabla();
                actualizarListaProductos(document.getElementById('buscar-producto-lista').value);
                this.reset();
            } catch (err) {
                alert(err.message);
            }
        });

        // --- FORMULARIO ENTRADA ---
        document.getElementById('form-entrada').addEventListener('submit', async function(e) {
            e.preventDefault();
            const nombre = document.getElementById('entrada-producto').value.trim();
            const cantidad = parseInt(document.getElementById('entrada-cantidad').value, 10);
            if (!nombre || isNaN(cantidad) || cantidad < 1) return;
            try {
                await registrarEntrada(nombre, cantidad, navigator.userAgent);
                await cargarInventario();
                await cargarMovimientos();
                await cargarEntradas();
                actualizarTabla();
                actualizarTablaEntradas();
                this.reset();
            } catch (err) {
                alert(err.message);
            }
        });

        // Función para mostrar notificación moderna (toast)
        function mostrarToast(mensaje) {
            const toast = document.getElementById('toast-notificacion');
            toast.textContent = mensaje;
            toast.style.display = 'block';
            toast.style.opacity = '1';
            toast.style.pointerEvents = 'auto';
            toast.style.transform = 'translateY(0)';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.pointerEvents = 'none';
                toast.style.transform = 'translateY(-20px)';
            }, 3200);
        }

        // --- FORMULARIO SALIDA ---
        document.getElementById('form-salida').addEventListener('submit', async function(e) {
            e.preventDefault();
            const nombre = document.getElementById('salida-producto').value.trim();
            const cantidad = parseInt(document.getElementById('salida-cantidad').value, 10);
            if (!nombre || isNaN(cantidad) || cantidad < 1) return;
            // Buscar existencia actual
            const prod = inventario.find(p => p.nombre.toLowerCase() === nombre.toLowerCase());
            if (!prod) {
                mostrarToast('Producto no encontrado en inventario.');
                return;
            }
            if (cantidad > prod.cantidad) {
                // Notificación moderna de existencia insuficiente
                mostrarToast(`No hay suficiente existencia. Existencia actual: ${prod.cantidad}`);
                mostrarExistenciaSalida(prod);
                return;
            }
            try {
                await registrarSalida(nombre, cantidad, navigator.userAgent);
                await cargarInventario();
                await cargarMovimientos();
                await cargarSalidas();
                actualizarTabla();
                actualizarTablaSalidas();
                mostrarExistenciaSalida(inventario.find(p => p.nombre.toLowerCase() === nombre.toLowerCase()));
                this.reset();
                setTimeout(() => mostrarExistenciaSalida(null), 500);
            } catch (err) {
                mostrarToast(err.message);
                mostrarExistenciaSalida(inventario.find(p => p.nombre.toLowerCase() === nombre.toLowerCase()));
            }
        });

        // --- LISTA Y BUSCADOR DE PRODUCTOS EN NUEVOS PRODUCTOS ---
        function actualizarListaProductos(filtro = '') {
            const ul = document.getElementById('lista-productos');
            ul.innerHTML = '';
            let lista = inventario;
            if (filtro) {
                const val = filtro.trim().toLowerCase();
                lista = inventario.filter(p => p.nombre.toLowerCase().includes(val));
            }
            if (lista.length === 0) {
                ul.innerHTML = '<li style="color:#888;font-size:0.98em;">Sin productos</li>';
                return;
            }
            lista.forEach(prod => {
                const li = document.createElement('li');
                li.textContent = `${prod.nombre} (${prod.cantidad})`;
                li.style.padding = '7px 0 7px 8px';
                li.style.borderBottom = '1px solid #e5e7eb';
                ul.appendChild(li);
            });
        }

        // --- ACTUALIZAR TARJETAS DE INVENTARIO ---
        function actualizarTabla() {
            const cont = document.getElementById('tarjetas-inventario');
            cont.innerHTML = '';
            let lista = inventario;
            if (filtroInventario) {
                lista = inventario.filter(prod => prod.nombre.toLowerCase().includes(filtroInventario));
            }
            if (!lista.length) {
                cont.innerHTML = '<div style="color:#888;font-size:1.08em;">Sin productos en inventario</div>';
                return;
            }
            lista.forEach(prod => {
                const card = document.createElement('div');
                card.className = 'tarjeta-inventario';
                card.innerHTML = `
                    <div class="existencia">${prod.cantidad}</div>
                    <div class="nombre">${prod.nombre}</div>
                `;
                cont.appendChild(card);
            });
        }

        // --- ACTUALIZAR TABLA ENTRADAS ---
        function actualizarTablaEntradas() {
            const tbody = document.getElementById('tabla-entradas').querySelector('tbody');
            tbody.innerHTML = '';
            entradas.forEach(ent => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${ent.producto}</td>
                                <td>${ent.cantidad}</td>
                                <td>${ent.fecha}</td>
                                <td>${ent.equipo}</td>`;
                tbody.appendChild(tr);
            });
        }

        // --- ACTUALIZAR TABLA SALIDAS ---
        function actualizarTablaSalidas() {
            const tbody = document.getElementById('tabla-salidas').querySelector('tbody');
            tbody.innerHTML = '';
            salidas.forEach(sal => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${sal.producto}</td>
                                <td>${sal.cantidad}</td>
                                <td>${sal.fecha}</td>
                                <td>${sal.equipo}</td>`;
                tbody.appendChild(tr);
            });
        }

        // --- MODIFICAR CAMBIO DE VENTANA PARA ACTUALIZAR TABLAS DE ENTRADAS Y SALIDAS ---
        Object.keys(secciones).forEach(btnId => {
            document.getElementById(btnId).addEventListener('click', async function() {
                // Botón activo
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                // Mostrar sección
                Object.values(secciones).forEach(secId => {
                    document.getElementById(secId).classList.add('hidden');
                });
                document.getElementById(secciones[btnId]).classList.remove('hidden');
                // Actualizar tablas si es necesario
                if (btnId === 'btn-inventario') {
                    await cargarInventario();
                    actualizarTabla();
                }
                if (btnId === 'btn-movimientos') {
                    await cargarMovimientos();
                    actualizarMovimientos();
                }
                if (btnId === 'btn-entradas') {
                    await cargarEntradas();
                    actualizarTablaEntradas();
                }
                if (btnId === 'btn-salidas') {
                    await cargarSalidas();
                    actualizarTablaSalidas();
                }
            });
        });

        // --- AUTOCOMPLETADO PARA BUSCAR PRODUCTO EN NUEVOS PRODUCTOS ---
        function setupBuscarProductoLista() {
            const input = document.getElementById('buscar-producto-lista');
            const list = document.getElementById('buscar-autocomplete-lista');
            input.addEventListener('input', function() {
                const val = input.value.trim().toLowerCase();
                list.innerHTML = '';
                if (!val) {
                    list.classList.add('hidden');
                    actualizarListaProductos('');
                    return;
                }
                // Autocompletado de productos existentes
                const matches = inventario.filter(p => p.nombre.toLowerCase().includes(val));
                if (matches.length === 0) {
                    list.classList.add('hidden');
                    actualizarListaProductos(val);
                    return;
                }
                matches.forEach(prod => {
                    const div = document.createElement('div');
                    div.className = 'autocomplete-item';
                    div.textContent = prod.nombre;
                    div.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        input.value = prod.nombre;
                        list.classList.add('hidden');
                        actualizarListaProductos(prod.nombre);
                    });
                    list.appendChild(div);
                });
                list.classList.remove('hidden');
                actualizarListaProductos(val);
            });
            input.addEventListener('blur', function() {
                setTimeout(() => list.classList.add('hidden'), 120);
            });
            input.addEventListener('focus', function() {
                input.dispatchEvent(new Event('input'));
            });
        }

        // --- BOTÓN LIMPIAR BUSCADOR EN NUEVOS PRODUCTOS ---
        document.getElementById('btn-limpiar-buscar-producto-lista').addEventListener('click', function() {
            const input = document.getElementById('buscar-producto-lista');
            input.value = '';
            document.getElementById('buscar-autocomplete-lista').classList.add('hidden');
            actualizarListaProductos('');
            input.focus();
        });

        // --- BOTÓN LIMPIAR BUSCADOR EN MOVIMIENTOS ---
        document.getElementById('mov-limpiar-filtros').addEventListener('click', function() {
            const input = document.getElementById('mov-buscar-producto');
            input.value = '';
            filtroMovProducto = '';
            document.getElementById('mov-autocomplete').classList.add('hidden');
            actualizarMovimientos();
            input.focus();
        });

        // --- Buscador de tarjetas de inventario ---
        let filtroInventario = '';
        document.getElementById('buscar-inventario').addEventListener('input', function() {
            filtroInventario = this.value.trim().toLowerCase();
            actualizarTabla();
        });
        document.getElementById('btn-limpiar-buscar-inventario').addEventListener('click', function() {
            document.getElementById('buscar-inventario').value = '';
            filtroInventario = '';
            actualizarTabla();
            document.getElementById('buscar-inventario').focus();
        });

        // --- INICIALIZACIÓN ---
        inicializarDatos();
        setupMovimientosAutocomplete();
        setupBuscarProductoLista();
        // Inicializar tablas de entradas y salidas al cargar
        cargarEntradas().then(actualizarTablaEntradas);
        cargarSalidas().then(actualizarTablaSalidas);
    </script>
    <!-- NOTA IMPORTANTE PARA EL BACKEND -->
    <!-- 
        Para que las entradas y salidas se guarden por separado en las tablas Entradas y Salidas de SQL Server,
        tu backend debe insertar un registro en la tabla correspondiente cada vez que se registre una entrada o salida.

        Ejemplo para Node.js/Express usando mssql:

        // ENTRADA
        app.post('/api/entrada', async (req, res) => {
            const { nombre, cantidad, equipo } = req.body;
            try {
                // Actualiza inventario y movimientos...
                await sql.query`INSERT INTO Entradas (producto, cantidad, fecha, equipo) VALUES (${nombre}, ${cantidad}, GETDATE(), ${equipo})`;
                res.json({ ok: true });
            } catch (err) {
                res.status(500).json({ error: 'Error al registrar entrada en la tabla Entradas' });
            }
        });

        // SALIDA
        app.post('/api/salida', async (req, res) => {
            const { nombre, cantidad, equipo } = req.body;
            try {
                // Actualiza inventario y movimientos...
                await sql.query`INSERT INTO Salidas (producto, cantidad, fecha, equipo) VALUES (${nombre}, ${cantidad}, GETDATE(), ${equipo})`;
                res.json({ ok: true });
            } catch (err) {
                res.status(500).json({ error: 'Error al registrar salida en la tabla Salidas' });
            }
        });

        Además, debes exponer los endpoints GET /api/entradas y /api/salidas para que el frontend pueda consultar estas tablas.
    -->
</body>
</html>
